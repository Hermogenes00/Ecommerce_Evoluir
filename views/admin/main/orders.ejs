<%- include('../../partials/header') %>
    <%- include('../../partials/navbaradmin') %>

        <div class="container mt-3">

            <div class="row">
                <div class="input-group col-md-6 mb-3">
                    <input id="cliente" name="cliente" type="text" class="form-control form-control-sm"
                        placeholder="Buscar cliente">
                    <div class="input-group-append">
                        <btn class="btn btn-outline-secondary btn-sm" id="btnBuscar" name="btnBuscar">Buscar</a>
                    </div>
                </div>
            </div>

            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Pedido</th>
                        <th>Cadastro</th>
                        <th>Cliente</th>
                        <th>Status</th>
                        <th>Valor</th>
                        <th>Frete</th>
                        <th>Total</th>
                        <th class="text-center">Ação</th>
                    </tr>
                </thead>
                <tbody>
                    <% ords.forEach(ord=> {%>
                        <tr>
                            <td>
                                <a href="#">
                                    <h6 data-id="<%= ord.cliente.id %>" onclick="onClick(event)">
                                        <%= ord.id %>
                                            <% if(ord.status=='CONCLUIDO' ){%>
                                                <i class="fas fa-flag"></i>
                                                <%} %>
                                    </h6>
                                </a>
                            </td>
                            <td>
                                <h6>
                                    <%= ord.createdAt.toLocaleDateString('pt-br')%>
                                </h6>
                            </td>
                            <td>
                                <h6>
                                    <%= ord.cliente.nome %>

                                        <% if(ord.pagamento){%>


                                            <% if(ord.pagamento.comprovante){%>
                                                <a href="#" id="btnVerComprovante" data-toggle="modal"
                                                    data-target="#modalVerComprovante" title="Analisar Comprovante"
                                                    data-comprovante="<%= ord.pagamento.comprovante %>"
                                                    data-idOrder="<%=ord.id%>" onclick="exibirComprovante(event)"
                                                    class="btn btn-sm btn-primary">Analisar
                                                    Comprovante <i class="fas fa-sticky-note"></i></a>
                                                <%} %>


                                </h6>
                                <%} %>

                            </td>
                            <td>
                                <h6>
                                    <%= ord.status %>
                                </h6>
                            </td>
                            <td>
                                <h6>
                                    <%= parseFloat(ord.total).toLocaleString('pt-br',{style:'currency',currency:'brl'})
                                        %>
                                </h6>
                            </td>
                            <td>
                                <h6>
                                    <%= parseFloat(ord.valorFrete).toLocaleString('pt-br',{style:'currency',currency:'brl'})
                                        %>
                                </h6>
                            </td>
                            <td>
                                <h6>
                                    <%= parseFloat(ord.valorFinal).toLocaleString('pt-br',{style:'currency',currency:'brl'})
                                        %>
                                </h6>
                            </td>
                            <td>
                                <div>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <form action="/order/resume/" method="POST">
                                                <input type="hidden" name="idOrder" value="<%= ord.id %>">
                                                <input data-toggle="tooltip" data-placement="top" title="Ver Ficha"
                                                    data-target="#exampleModal" type="submit"
                                                    class="btn btn-danger btn-sm" value="Ver Ficha">
                                            </form>
                                        </div>
                                    </div>

                                </div>
                            </td>
                        </tr>

                        <%}); %>

                </tbody>
            </table>
        </div>
        <%- include('../../partials/main/order/modalVerComprovante.ejs') %>

            </div>

            <%- include('../../partials/footer') %>


                <script src="/js/modalVerComprovante.js"></script>
                <script>
                    let cliente = document.getElementById('cliente')

                    document.getElementById('btnBuscar').addEventListener('click', () => {
                        document.location.href = cliente.value ? cliente.value : 'all'
                    })

                </script>